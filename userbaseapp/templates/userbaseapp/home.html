<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Base App with Bets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                }
            }
        }
    </script>
    <style>
        .spreadsheet-cell {
            padding: 5px 8px;
            border-right: 1px solid #e5e7eb;
            min-width: 100px;
            text-align: left;
            font-size: 0.9rem;
            height: 30px;
            white-space: nowrap;
        }

        .header-cell {
            background-color: #f3f4f6;
            font-weight: 600;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .row-number-cell {
            background-color: #f3f4f6;
            font-weight: 600;
            text-align: center;
            min-width: 50px;
            position: sticky;
            left: 0;
            z-index: 15;
            border-right: 2px solid #d1d5db;
        }

        .data-row:hover .spreadsheet-cell {
            background-color: #f9fafb;
        }

        .bet-button {
            background-color: #4f46e5;
            color: white;
            border-radius: 9999px;
            padding: 2px 6px;
            font-size: 0.7rem;
            margin-left: 4px;
            cursor: pointer;
        }

        .bet-button:hover {
            background-color: #4338ca;
        }

        .delete-button {
            background-color: #ef4444;
            color: white;
            border-radius: 4px;
            padding: 2px 8px;
            font-size: 0.75rem;
            margin-left: 8px;
            cursor: pointer;
            border: none;
        }

        .delete-button:hover {
            background-color: #dc2626;
        }

        .amount-button {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .amount-button:hover {
            border-color: #4f46e5;
            background-color: #eef2ff;
        }

        .amount-button.selected {
            border-color: #4f46e5;
            background-color: #4f46e5;
            color: white;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 320px;
            max-width: 420px;
            pointer-events: auto;
            transform: translateX(120%);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-left: 4px solid;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left-color: #22c55e;
        }

        .toast.error {
            border-left-color: #ef4444;
        }

        .toast.warning {
            border-left-color: #f59e0b;
        }

        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* Loader Overlay */
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            backdrop-filter: blur(4px);
        }

        .loader-overlay.active {
            display: flex;
        }

        .loader-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .spinner {
            --size: 30px;
            --first-block-clr: #005bba;
            --second-block-clr: #fed500;
            width: 100px;
            height: 100px;
            position: relative;
        }

        .spinner::after,
        .spinner::before {
            box-sizing: border-box;
            position: absolute;
            content: "";
            width: var(--size);
            height: var(--size);
            top: 50%;
            animation: up 2.4s cubic-bezier(0, 0, 0.24, 1.21) infinite;
            left: 50%;
            background: var(--first-block-clr);
        }

        .spinner::after {
            background: var(--second-block-clr);
            top: calc(50% - var(--size));
            left: calc(50% - var(--size));
            animation: down 2.4s cubic-bezier(0, 0, 0.24, 1.21) infinite;
        }

        .loader-percentage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }

        .loader-text {
            color: #fff;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
        }

        @keyframes down {
            0%, 100% {
                transform: none;
            }
            25% {
                transform: translateX(100%);
            }
            50% {
                transform: translateX(100%) translateY(100%);
            }
            75% {
                transform: translateY(100%);
            }
        }

        @keyframes up {
            0%, 100% {
                transform: none;
            }
            25% {
                transform: translateX(-100%);
            }
            50% {
                transform: translateX(-100%) translateY(-100%);
            }
            75% {
                transform: translateY(-100%);
            }
        }

        /* Disable pointer events during loading */
        body.loading {
            pointer-events: none;
            user-select: none;
        }

        body.loading .loader-overlay {
            pointer-events: auto;
        }

        .toast.success .toast-icon {
            background-color: #dcfce7;
            color: #16a34a;
        }

        .toast.error .toast-icon {
            background-color: #fee2e2;
            color: #dc2626;
        }

        .toast.warning .toast-icon {
            background-color: #fef3c7;
            color: #d97706;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .toast.success .toast-title {
            color: #16a34a;
        }

        .toast.error .toast-title {
            color: #dc2626;
        }

        .toast.warning .toast-title {
            color: #d97706;
        }

        .toast-message {
            color: #6b7280;
            font-size: 14px;
        }

        .toast-close {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 20px;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .toast-close:hover {
            background-color: #f3f4f6;
            color: #4b5563;
        }

        .modal-content {
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .modal-body-scrollable {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        /* Checkbox label styling - highlight when checked */
        label:has(input[type="checkbox"]:checked) {
            border-color: currentColor !important;
            background-color: rgba(var(--tw-color-rgb), 0.1);
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen font-sans">

    <div id="toastContainer" class="toast-container"></div>

    <!-- Loader Overlay -->
    <div id="loaderOverlay" class="loader-overlay">
        <div class="loader-container">
            <div class="spinner">
                <div class="loader-percentage" id="loaderPercentage">0%</div>
            </div>
            <div class="loader-text" id="loaderText">Loading...</div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto p-4 sm:p-8">
        <div class="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
            <div id="pagination-buttons" class="flex flex-wrap items-center gap-3">
                <button id="page-1-btn"
                    class="text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 shadow-lg font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                    <strong>All SP</strong>
                </button>
                <button id="page-2-btn"
                    class="text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 shadow-lg font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                    <strong>All DP</strong>
                </button>
            </div>
            <div class="flex items-center gap-4">
                <button id="toggleHistoryBtn"
                    class="text-white bg-gradient-to-r from-purple-500 via-purple-600 to-purple-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-purple-300 shadow-lg font-medium rounded-lg text-sm px-4 py-2.5 flex items-center gap-2 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                    History
                </button>
                <button id="toggleQuickBetBtn"
                    class="text-white bg-gradient-to-r from-indigo-500 via-indigo-600 to-indigo-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-indigo-300 shadow-lg font-medium rounded-lg text-sm px-4 py-2.5 flex items-center gap-2 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Quick Bet
                </button>
                <div class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg shadow-md">
                    <p class="text-xs font-medium">Total Balance</p>
                    <p class="text-xl font-bold" id="totalBalance">â‚¹0</p>
                </div>
                <div class="flex items-center space-x-4 bg-white p-2 rounded-lg shadow-inner border border-gray-200">
                    <p class="text-gray-700 text-sm sm:text-base font-medium">
                        Welcome, <span class="font-semibold text-indigo-700">{{ request.user.get_username }}</span>
                    </p>
                    <a href="{% url 'userbaseapp:logout' %}"
                        class="px-3 py-1 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition text-sm">Logout</a>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-2xl overflow-hidden border border-gray-200">
            <div class="overflow-x-auto">
                <table id="spreadsheet-table" class="min-w-full divide-y divide-gray-200 border-collapse table-auto">
                    <thead>
                        <tr>
                            <th class="row-number-cell border-b-2 border-gray-300">Row</th>
                            <th class="spreadsheet-cell header-cell border-b-2 border-gray-300">1</th>
                            <th class="spreadsheet-cell header-cell border-b-2 border-gray-300">2</th>
                            <th class="spreadsheet-cell header-cell border-b-2 border-gray-300">3</th>
                            <th class="spreadsheet-cell header-cell border-b-2 border-gray-300">4</th>
                            <th class="spreadsheet-cell header-cell border-b-2 border-gray-300">5</th>
                            <th class="spreadsheet-cell header-cell border-b-2 border-gray-300">6</th>
                            <th class="spreadsheet-cell header-cell border-b-2 border-gray-300">7</th>
                            <th class="spreadsheet-cell header-cell border-b-2 border-gray-300">8</th>
                            <th class="spreadsheet-cell header-cell border-b-2 border-gray-300">9</th>
                            <th class="spreadsheet-cell header-cell border-b-2 border-gray-300">10</th>
                        </tr>
                    </thead>
                    <tbody id="spreadsheet-body"></tbody>
                </table>
            </div>
        </div>

        <div class="mt-6 flex flex-wrap gap-3 justify-center sm:justify-end px-4 sm:px-0">
            <button id="all-sp-btn"
                class="text-gray-900 bg-gradient-to-r from-lime-200 via-lime-400 to-lime-500 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-lime-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                Place Bet on ALL SP
            </button>
            <button id="all-dp-btn"
                class="text-gray-900 bg-gradient-to-r from-lime-200 via-lime-400 to-lime-500 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-lime-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                Place Bet on ALL DP
            </button>
            <button id="jodi-btn"
                class="text-white bg-gradient-to-r from-purple-500 via-purple-600 to-purple-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-purple-300 shadow-lg font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                Jodi Vagar
            </button>
            <button id="eki-beki-btn"
                class="text-white bg-gradient-to-r from-cyan-500 via-cyan-600 to-cyan-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-cyan-300 shadow-lg font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                Eki/Beki/Dadar
            </button>
            <button id="abr-cut-btn"
                class="text-white bg-gradient-to-r from-pink-500 via-pink-600 to-pink-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-pink-300 shadow-lg font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                ABR Cut
            </button>
            <button id="jodi-panel-btn"
                class="text-white bg-gradient-to-r from-teal-500 via-teal-600 to-teal-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-teal-300 shadow-lg font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                Jodi Panel
            </button>
            <button id="motar-btn"
                class="text-white bg-gradient-to-r from-orange-500 via-orange-600 to-orange-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-orange-300 shadow-lg font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                Motar
            </button>
            <button id="comman-pana-btn"
                class="text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 shadow-lg font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                Common Bet
            </button>
            <button id="set-pana-btn"
                class="text-white bg-gradient-to-r from-indigo-500 via-indigo-600 to-indigo-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-indigo-300 shadow-lg font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                Set Pana
            </button>
        </div>
    </div>

    <!-- Bulk Action History Modal (Full Screen) -->
    <div id="historyModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-11/12 h-5/6 flex flex-col">
            <!-- Modal Header -->
            <div class="p-6 border-b border-gray-200 flex justify-between items-center flex-shrink-0">
                <h2 class="text-2xl font-bold text-purple-700">ðŸ“‹ Bulk Action History</h2>
                <button id="closeHistoryModal" class="text-gray-500 hover:text-gray-700 text-3xl font-bold">&times;</button>
            </div>

            <!-- Excel-like Table -->
            <div class="flex-1 overflow-auto p-6">
                <div class="overflow-x-auto">
                    <table id="historyTable" class="w-full border-collapse border border-gray-300">
                        <thead class="bg-purple-100 sticky top-0">
                            <tr>
                                <th class="border border-gray-300 px-4 py-3 text-left text-sm font-bold text-gray-700">ID</th>
                                <th class="border border-gray-300 px-4 py-3 text-left text-sm font-bold text-gray-700">Action Type</th>
                                <th class="border border-gray-300 px-4 py-3 text-left text-sm font-bold text-gray-700">Amount (â‚¹)</th>
                                <th class="border border-gray-300 px-4 py-3 text-left text-sm font-bold text-gray-700">Total Bets</th>
                                <th class="border border-gray-300 px-4 py-3 text-left text-sm font-bold text-gray-700">Column</th>
                                <th class="border border-gray-300 px-4 py-3 text-left text-sm font-bold text-gray-700">Number</th>
                                <th class="border border-gray-300 px-4 py-3 text-left text-sm font-bold text-gray-700">Date & Time</th>
                                <th class="border border-gray-300 px-4 py-3 text-left text-sm font-bold text-gray-700">Status</th>
                                <th class="border border-gray-300 px-4 py-3 text-center text-sm font-bold text-gray-700">Action</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody" class="bg-white">
                            <tr>
                                <td colspan="9" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                                    Loading history...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Footer with Stats -->
            <div class="p-6 border-t border-gray-200 bg-gray-50 flex-shrink-0">
                <div class="flex justify-between items-center">
                    <div class="flex gap-6">
                        <div>
                            <span class="text-sm font-medium text-gray-600">Total Records:</span>
                            <span id="totalRecords" class="text-lg font-bold text-purple-700 ml-2">0</span>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-600">Total Amount:</span>
                            <span id="totalHistoryAmount" class="text-lg font-bold text-green-600 ml-2">â‚¹0</span>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-600">Total Bets:</span>
                            <span id="totalHistoryBets" class="text-lg font-bold text-blue-600 ml-2">0</span>
                        </div>
                    </div>
                    <button id="refreshHistoryBtn" 
                        class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition font-semibold">
                        ðŸ”„ Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Bet Entry Table (Bottom Left) -->
    <div id="quickBetContainer" class="hidden fixed bottom-4 left-4 bg-white rounded-xl shadow-2xl border-2 border-indigo-500 p-4 z-40" style="width: 320px;">
        <div class="flex justify-between items-center mb-3">
            <h3 class="text-lg font-bold text-indigo-700">Quick Bet Entry</h3>
            <button id="closeQuickBetBtn" class="text-gray-500 hover:text-gray-700 text-xl font-bold">&times;</button>
        </div>
        
        <div class="overflow-auto" style="max-height: 300px;">
            <table class="w-full border-collapse">
                <thead class="bg-indigo-100 sticky top-0">
                    <tr>
                        <th class="border border-gray-300 px-2 py-2 text-sm font-semibold text-gray-700 w-12">Row</th>
                        <th class="border border-gray-300 px-2 py-2 text-sm font-semibold text-gray-700">A (Number)</th>
                        <th class="border border-gray-300 px-2 py-2 text-sm font-semibold text-gray-700">B (Amount)</th>
                        <th class="border border-gray-300 px-2 py-2 text-sm font-semibold text-gray-700 w-10"></th>
                    </tr>
                </thead>
                <tbody id="quickBetTableBody">
                    <tr data-row="1">
                        <td class="border border-gray-300 px-2 py-2 text-center text-sm font-medium text-gray-600">1</td>
                        <td class="border border-gray-300 p-1">
                            <input type="text" 
                                class="quick-bet-number w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                                placeholder="3-digit" 
                                maxlength="3"
                                data-row="1">
                        </td>
                        <td class="border border-gray-300 p-1">
                            <input type="number" 
                                class="quick-bet-amount w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                                placeholder="Amount"
                                min="1"
                                data-row="1">
                        </td>
                        <td class="border border-gray-300 p-1 text-center">
                            <button class="remove-row-btn text-red-500 hover:text-red-700 hover:bg-red-50 rounded p-1 transition" title="Remove row">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                    <tr data-row="2">
                        <td class="border border-gray-300 px-2 py-2 text-center text-sm font-medium text-gray-600">2</td>
                        <td class="border border-gray-300 p-1">
                            <input type="text" 
                                class="quick-bet-number w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                                placeholder="3-digit" 
                                maxlength="3"
                                data-row="2">
                        </td>
                        <td class="border border-gray-300 p-1">
                            <input type="number" 
                                class="quick-bet-amount w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                                placeholder="Amount"
                                min="1"
                                data-row="2">
                        </td>
                        <td class="border border-gray-300 p-1 text-center">
                            <button class="remove-row-btn text-red-500 hover:text-red-700 hover:bg-red-50 rounded p-1 transition" title="Remove row">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="mt-3 flex gap-2">
            <button id="quickBetOkayBtn"
                class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:from-green-600 hover:to-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 shadow-md transition">
                Place Bets
            </button>
            <button id="quickBetClearBtn"
                class="bg-gray-400 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-400 shadow-md transition">
                Clear
            </button>
        </div>
    </div>

    <!-- Universal Modal -->
    <div id="universalModal"
        class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white w-96 rounded-2xl shadow-2xl modal-content"
            style="max-height: 85vh; display: flex; flex-direction: column;">
            <!-- Modal Header - Fixed -->
            <div class="p-6 pb-4 flex-shrink-0">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="modalTitle" class="text-xl font-semibold text-gray-800">Place a Bet</h2>
                    <button id="closeModal"
                        class="text-gray-500 hover:text-gray-700 text-xl font-bold">&times;</button>
                </div>

                <!-- Tab Navigation -->
                <div class="border-b flex">
                    <button id="placeTab"
                        class="flex-1 py-2 text-center font-semibold border-b-2 border-indigo-600 text-indigo-600">
                        Place a Bet
                    </button>
                    <button id="historyTab"
                        class="flex-1 py-2 text-center font-semibold border-b-2 border-transparent text-gray-500 hover:text-indigo-600">
                        History
                    </button>
                </div>
            </div>

            <!-- Scrollable Content Area -->
            <div class="px-6 pb-6 overflow-y-auto flex-1" style="min-height: 0;">
                <!-- Place Bet Content -->
                <div id="placeContent">
                    <div class="space-y-4">
                        <!-- SINGLE, SP, DP Options -->
                        <div id="columnOptions" class="hidden space-y-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Select Columns</label>
                                <div class="grid grid-cols-5 gap-2">
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-indigo-50 transition">
                                        <input type="checkbox" value="1" class="betColumnCheckbox w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                        <span class="text-sm font-medium">1</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-indigo-50 transition">
                                        <input type="checkbox" value="2" class="betColumnCheckbox w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                        <span class="text-sm font-medium">2</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-indigo-50 transition">
                                        <input type="checkbox" value="3" class="betColumnCheckbox w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                        <span class="text-sm font-medium">3</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-indigo-50 transition">
                                        <input type="checkbox" value="4" class="betColumnCheckbox w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                        <span class="text-sm font-medium">4</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-indigo-50 transition">
                                        <input type="checkbox" value="5" class="betColumnCheckbox w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                        <span class="text-sm font-medium">5</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-indigo-50 transition">
                                        <input type="checkbox" value="6" class="betColumnCheckbox w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                        <span class="text-sm font-medium">6</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-indigo-50 transition">
                                        <input type="checkbox" value="7" class="betColumnCheckbox w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                        <span class="text-sm font-medium">7</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-indigo-50 transition">
                                        <input type="checkbox" value="8" class="betColumnCheckbox w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                        <span class="text-sm font-medium">8</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-indigo-50 transition">
                                        <input type="checkbox" value="9" class="betColumnCheckbox w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                        <span class="text-sm font-medium">9</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-indigo-50 transition">
                                        <input type="checkbox" value="10" class="betColumnCheckbox w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                        <span class="text-sm font-medium">10</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Jodi Options -->
                        <div id="jodiOptions" class="hidden space-y-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Select Type</label>
                                <select id="jodiType"
                                    class="w-full border-2 border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="5">Jodi Vagar 5</option>
                                    <option value="7">Jodi Vagar DP 7</option>
                                    <option value="12">Jodi Vagar 12</option>
                                </select>
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Select Columns</label>
                                <div class="grid grid-cols-5 gap-2">
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-purple-50 transition">
                                        <input type="checkbox" value="1" class="jodiColumnCheckbox w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                        <span class="text-sm font-medium">1</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-purple-50 transition">
                                        <input type="checkbox" value="2" class="jodiColumnCheckbox w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                        <span class="text-sm font-medium">2</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-purple-50 transition">
                                        <input type="checkbox" value="3" class="jodiColumnCheckbox w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                        <span class="text-sm font-medium">3</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-purple-50 transition">
                                        <input type="checkbox" value="4" class="jodiColumnCheckbox w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                        <span class="text-sm font-medium">4</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-purple-50 transition">
                                        <input type="checkbox" value="5" class="jodiColumnCheckbox w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                        <span class="text-sm font-medium">5</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-purple-50 transition">
                                        <input type="checkbox" value="6" class="jodiColumnCheckbox w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                        <span class="text-sm font-medium">6</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-purple-50 transition">
                                        <input type="checkbox" value="7" class="jodiColumnCheckbox w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                        <span class="text-sm font-medium">7</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-purple-50 transition">
                                        <input type="checkbox" value="8" class="jodiColumnCheckbox w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                        <span class="text-sm font-medium">8</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-purple-50 transition">
                                        <input type="checkbox" value="9" class="jodiColumnCheckbox w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                        <span class="text-sm font-medium">9</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-purple-50 transition">
                                        <input type="checkbox" value="10" class="jodiColumnCheckbox w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                        <span class="text-sm font-medium">10</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Eki/Beki/Dadar Options -->
                        <div id="ekiBekiOptions" class="hidden space-y-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Select Type</label>
                                <select id="ekiBekiType"
                                    class="w-full border-2 border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                                    <option value="EKI">Eki (13579) - 10 numbers</option>
                                    <option value="BEKI">Beki (24680) - 10 numbers</option>
                                    <option value="DADAR">Dadar - 10 numbers</option>
                                </select>
                            </div>
                        </div>

                        <!-- ABR Cut Options -->
                        <div id="abrCutOptions" class="hidden space-y-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Select Columns</label>
                                <div class="grid grid-cols-5 gap-2">
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-pink-50 transition">
                                        <input type="checkbox" value="1" class="abrCutColumnCheckbox w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
                                        <span class="text-sm font-medium">1</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-pink-50 transition">
                                        <input type="checkbox" value="2" class="abrCutColumnCheckbox w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
                                        <span class="text-sm font-medium">2</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-pink-50 transition">
                                        <input type="checkbox" value="3" class="abrCutColumnCheckbox w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
                                        <span class="text-sm font-medium">3</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-pink-50 transition">
                                        <input type="checkbox" value="4" class="abrCutColumnCheckbox w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
                                        <span class="text-sm font-medium">4</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-pink-50 transition">
                                        <input type="checkbox" value="5" class="abrCutColumnCheckbox w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
                                        <span class="text-sm font-medium">5</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-pink-50 transition">
                                        <input type="checkbox" value="6" class="abrCutColumnCheckbox w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
                                        <span class="text-sm font-medium">6</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-pink-50 transition">
                                        <input type="checkbox" value="7" class="abrCutColumnCheckbox w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
                                        <span class="text-sm font-medium">7</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-pink-50 transition">
                                        <input type="checkbox" value="8" class="abrCutColumnCheckbox w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
                                        <span class="text-sm font-medium">8</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-pink-50 transition">
                                        <input type="checkbox" value="9" class="abrCutColumnCheckbox w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
                                        <span class="text-sm font-medium">9</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-pink-50 transition">
                                        <input type="checkbox" value="10" class="abrCutColumnCheckbox w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
                                        <span class="text-sm font-medium">10</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Jodi Panel Options -->
                        <div id="jodiPanelOptions" class="hidden space-y-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Select Type</label>
                                <select id="jodiPanelType"
                                    class="w-full border-2 border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-teal-500">
                                    <option value="9">Jodi Panel 9 (All 9 numbers)</option>
                                    <option value="7">Jodi Panel 7 (First 7 numbers)</option>
                                    <option value="6">Jodi Panel 6 (First 6 numbers)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Select Columns</label>
                                <div class="grid grid-cols-5 gap-2">
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-teal-50 transition">
                                        <input type="checkbox" value="1" class="jodiPanelColumnCheckbox w-4 h-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500">
                                        <span class="text-sm font-medium">1</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-teal-50 transition">
                                        <input type="checkbox" value="2" class="jodiPanelColumnCheckbox w-4 h-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500">
                                        <span class="text-sm font-medium">2</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-teal-50 transition">
                                        <input type="checkbox" value="3" class="jodiPanelColumnCheckbox w-4 h-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500">
                                        <span class="text-sm font-medium">3</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-teal-50 transition">
                                        <input type="checkbox" value="4" class="jodiPanelColumnCheckbox w-4 h-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500">
                                        <span class="text-sm font-medium">4</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-teal-50 transition">
                                        <input type="checkbox" value="5" class="jodiPanelColumnCheckbox w-4 h-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500">
                                        <span class="text-sm font-medium">5</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-teal-50 transition">
                                        <input type="checkbox" value="6" class="jodiPanelColumnCheckbox w-4 h-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500">
                                        <span class="text-sm font-medium">6</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-teal-50 transition">
                                        <input type="checkbox" value="7" class="jodiPanelColumnCheckbox w-4 h-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500">
                                        <span class="text-sm font-medium">7</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-teal-50 transition">
                                        <input type="checkbox" value="8" class="jodiPanelColumnCheckbox w-4 h-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500">
                                        <span class="text-sm font-medium">8</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-teal-50 transition">
                                        <input type="checkbox" value="9" class="jodiPanelColumnCheckbox w-4 h-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500">
                                        <span class="text-sm font-medium">9</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer p-2 border-2 border-gray-300 rounded-lg hover:bg-teal-50 transition">
                                        <input type="checkbox" value="10" class="jodiPanelColumnCheckbox w-4 h-4 text-teal-600 border-gray-300 rounded focus:ring-teal-500">
                                        <span class="text-sm font-medium">10</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Motar Options -->
                        <div id="motarOptions" class="hidden space-y-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Enter Number (4-10 digits)</label>
                                <input type="text" id="motarNumberInput" 
                                    placeholder="e.g. 4789" 
                                    maxlength="10"
                                    class="w-full border-2 border-gray-300 rounded-lg p-3 text-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500" />
                                <p class="text-xs text-gray-500 mt-1">Enter 4-10 digit number. Only digits 0-9 allowed.</p>
                            </div>
                            <div id="motarGeneratedNumbers" class="hidden">
                                <label class="block mb-2 text-sm font-medium text-gray-700">Generated 3-Digit Numbers:</label>
                                <div id="motarNumbersList" class="p-3 bg-orange-50 border-2 border-orange-200 rounded-lg">
                                    <div class="flex flex-wrap gap-2" id="motarNumbersDisplay"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">
                                    <span id="motarNumbersCount">0</span> numbers will be generated
                                </p>
                            </div>
                        </div>

                        <!-- Comman Pana 36 Options -->
                        <div id="commanPanaOptions" class="hidden space-y-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Select Common Bet Type</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-3 cursor-pointer p-3 border-2 border-gray-300 rounded-lg hover:bg-blue-50 transition">
                                        <input type="checkbox" id="commanPana36Checkbox" value="36" class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                        <div class="flex-1">
                                            <span class="text-sm font-semibold text-gray-800">Common Pana 36</span>
                                            <p class="text-xs text-gray-500">Find numbers from SP only (36 numbers max)</p>
                                        </div>
                                    </label>
                                    <label class="flex items-center space-x-3 cursor-pointer p-3 border-2 border-gray-300 rounded-lg hover:bg-blue-50 transition">
                                        <input type="checkbox" id="commanPana56Checkbox" value="56" class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                        <div class="flex-1">
                                            <span class="text-sm font-semibold text-gray-800">Common Pana 56</span>
                                            <p class="text-xs text-gray-500">Find numbers from SP + DP (56 numbers max)</p>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Enter Single Digit (0-9)</label>
                                <input type="text" id="commanPanaDigitInput" 
                                    placeholder="e.g. 4" 
                                    maxlength="1"
                                    class="w-full border-2 border-gray-300 rounded-lg p-3 text-lg text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                                <p class="text-xs text-gray-500 mt-1">Enter a single digit (0-9). System will find matching numbers based on selected type.</p>
                            </div>
                            <div id="commanPanaGeneratedNumbers" class="hidden">
                                <label class="block mb-2 text-sm font-medium text-gray-700">Found Numbers:</label>
                                <div id="commanPanaNumbersList" class="p-3 bg-blue-50 border-2 border-blue-200 rounded-lg max-h-48 overflow-y-auto">
                                    <div class="flex flex-wrap gap-2" id="commanPanaNumbersDisplay"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">
                                    <span id="commanPanaNumbersCount">0</span> numbers contain this digit
                                </p>
                            </div>
                        </div>

                        <!-- Set Pana Options -->
                        <div id="setPanaOptions" class="hidden space-y-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Enter 3-Digit Number</label>
                                <input type="text" id="setPanaNumberInput" 
                                    placeholder="e.g. 115, 156, 660" 
                                    maxlength="3"
                                    class="w-full border-2 border-gray-300 rounded-lg p-3 text-lg text-center focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
                                <p class="text-xs text-gray-500 mt-1">Enter any 3-digit number from a family group (e.g., 115, 156, 110 are all in G17)</p>
                            </div>
                            <div id="setPanaFamilyInfo" class="hidden">
                                <div class="p-4 bg-indigo-50 border-2 border-indigo-200 rounded-lg">
                                    <p class="text-sm font-semibold text-indigo-800 mb-2">
                                        Family: <span id="setPanaFamilyName" class="text-indigo-600"></span>
                                    </p>
                                    <label class="block mb-2 text-xs font-medium text-gray-700">All numbers in this family:</label>
                                    <div class="flex flex-wrap gap-2" id="setPanaFamilyNumbers"></div>
                                    <p class="text-xs text-gray-500 mt-2">
                                        <span id="setPanaFamilyCount">0</span> numbers in this family
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Select All Columns Checkbox (for Jodi, Dadar, ABR Cut, Jodi Panel) -->
                        <div id="selectAllColumnsContainer" class="hidden mb-4">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="selectAllColumnsCheckbox" 
                                    class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 cursor-pointer">
                                <span class="text-sm font-medium text-gray-700">Select All Columns (1-10)</span>
                            </label>
                            <p class="text-xs text-gray-500 mt-1 ml-7">Check this to place bets on all 10 columns</p>
                        </div>

                        <!-- Amount Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Quick amounts:</label>
                            <div class="grid grid-cols-4 gap-2 mb-4">
                                <button class="amount-button" data-amount="1">â‚¹1</button>
                                <button class="amount-button" data-amount="2">â‚¹2</button>
                                <button class="amount-button" data-amount="2.5">â‚¹2.5</button>
                                <button class="amount-button" data-amount="5">â‚¹5</button>
                            </div>

                            <div class="relative my-4">
                                <div class="absolute inset-0 flex items-center">
                                    <div class="w-full border-t border-gray-300"></div>
                                </div>
                                <div class="relative flex justify-center text-sm">
                                    <span class="px-2 bg-white text-gray-500">OR</span>
                                </div>
                            </div>

                            <label for="customAmount" class="block text-sm font-medium text-gray-700 mb-2">Custom
                                amount:</label>
                            <input type="number" id="customAmount" placeholder="e.g. 1, 123, 246..." min="1"
                                max="5000" step="1"
                                class="w-full border-2 border-gray-300 rounded-lg p-3 text-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
                            <p class="text-xs text-gray-500 mt-1">Min: â‚¹1 | Max: â‚¹5,000 | Any amount allowed</p>
                        </div>

                        <!-- Action Buttons -->
                        <div class="space-y-2 pt-2">
                            <div class="flex gap-2">
                                <button id="cancelBtn"
                                    class="flex-1 px-4 py-2 bg-gray-300 rounded-lg text-gray-800 font-semibold hover:bg-gray-400 transition">Cancel</button>
                                <button id="confirmBtn"
                                    class="flex-1 px-4 py-2 bg-indigo-600 rounded-lg text-white font-semibold hover:bg-indigo-700 transition">Place
                                    Bet</button>
                            </div>

                            <button id="undoBtn"
                                class="w-full px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition hidden">
                                Undo Last Action
                            </button>
                        </div>
                    </div>
                </div>

                <!-- History Content -->
                <div id="historyContent" class="hidden">
                    <div id="historyList" class="space-y-2">
                        <div class="p-4 text-center text-gray-500">
                            No history available
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // API Endpoints
            const API = {
                PLACE_BET: '/place-bet/',
                PLACE_BULK: '/place-bulk-bet/',
                LOAD_BETS: '/load-bets/',
                DELETE_BET: '/delete-bet/',
                UNDO_BULK: '/undo-bulk-action/',
                GET_LAST_BULK: '/get-last-bulk-action/',
                GET_BET_TOTAL: '/get-bet-total/',
                GENERATE_MOTAR: '/generate-motar-numbers/',
                FIND_COMMAN_PANA: '/find-comman-pana-numbers/',
                PLACE_MOTAR: '/place-motar-bet/',
                PLACE_COMMAN_PANA: '/place-comman-pana-bet/',
                PLACE_SET_PANA: '/place-set-pana-bet/',
                GET_BULK_HISTORY: '/get-bulk-action-history/',
            };

            const rowLabels = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V'];
            const allColumnData = [
                [128, 137, 146, 236, 245, 290, 380, 470, 489, 560, 579, 678, 100, 119, 155, 227, 335, 344, 399, 588, 669, 777],
                [129, 138, 147, 156, 237, 246, 345, 390, 480, 570, 589, 679, 110, 200, 228, 255, 336, 499, 660, 688, 778, 444],
                [120, 139, 148, 157, 238, 247, 256, 346, 490, 580, 670, 689, 166, 229, 300, 337, 355, 445, 599, 779, 788, 111],
                [130, 149, 158, 167, 239, 248, 257, 347, 356, 590, 680, 789, 112, 220, 266, 338, 400, 446, 455, 699, 770, 888],
                [140, 159, 168, 230, 249, 258, 267, 348, 357, 456, 690, 780, 113, 122, 177, 339, 366, 447, 500, 799, 889, 555],
                [123, 150, 169, 178, 240, 259, 268, 349, 358, 367, 457, 790, 114, 277, 330, 448, 466, 556, 600, 880, 899, 222],
                [124, 160, 179, 250, 269, 278, 340, 359, 368, 458, 467, 890, 115, 133, 188, 223, 377, 449, 557, 566, 700, 999],
                [125, 134, 170, 189, 260, 279, 350, 369, 378, 459, 468, 567, 116, 224, 233, 288, 440, 477, 558, 800, 990, 666],
                [126, 135, 180, 234, 270, 289, 360, 379, 450, 469, 478, 568, 117, 144, 199, 225, 388, 559, 577, 667, 900, 333],
                [127, 136, 145, 190, 235, 280, 370, 389, 460, 479, 569, 578, 118, 226, 244, 299, 334, 488, 550, 668, 677, '000']
            ];

            let bets = {};
            let currentNumber = null;
            let currentBetType = null; // 'SINGLE', 'SP', 'DP', 'JODI', 'DADAR', 'EKI_BEKI', 'ABR_CUT'
            let lastBulkAction = null;
            let selectedAbrColumns = []; // Array to store selected columns for multi-selection
            let lastMotarBets = []; // Track last Motar bet IDs for undo
            let lastCommanPanaBets = []; // Track last Comman Pana bet IDs for undo

            // Loader Functions
            const loaderOverlay = document.getElementById('loaderOverlay');
            const loaderPercentage = document.getElementById('loaderPercentage');
            const loaderText = document.getElementById('loaderText');

            function showLoader(text = 'Loading...', percentage = 0) {
                loaderOverlay.classList.add('active');
                document.body.classList.add('loading');
                loaderText.textContent = text;
                loaderPercentage.textContent = percentage + '%';
            }

            function updateLoader(percentage, text = null) {
                loaderPercentage.textContent = percentage + '%';
                if (text) {
                    loaderText.textContent = text;
                }
            }

            function hideLoader() {
                loaderOverlay.classList.remove('active');
                document.body.classList.remove('loading');
                loaderPercentage.textContent = '0%';
                loaderText.textContent = 'Loading...';
            }

            // Modal Elements
            const modal = document.getElementById('universalModal');
            const closeModalBtn = document.getElementById('closeModal');
            const modalTitle = document.getElementById('modalTitle');
            const placeTab = document.getElementById('placeTab');
            const historyTab = document.getElementById('historyTab');
            const placeContent = document.getElementById('placeContent');
            const historyContent = document.getElementById('historyContent');
            const historyList = document.getElementById('historyList');
            const cancelBtn = document.getElementById('cancelBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            const undoBtn = document.getElementById('undoBtn');
            const customAmountInput = document.getElementById('customAmount');
            const amountButtons = document.querySelectorAll('.amount-button');
            const columnOptions = document.getElementById('columnOptions');
            const dadarOptions = document.getElementById('dadarOptions');
            const jodiOptions = document.getElementById('jodiOptions');
            const ekiBekiOptions = document.getElementById('ekiBekiOptions');
            const abrCutOptions = document.getElementById('abrCutOptions');
            const jodiPanelOptions = document.getElementById('jodiPanelOptions');
            const motarOptions = document.getElementById('motarOptions');
            const commanPanaOptions = document.getElementById('commanPanaOptions');
            const setPanaOptions = document.getElementById('setPanaOptions');
            const tbody = document.getElementById('spreadsheet-body');

            function getCSRFToken() {
                return document.cookie.split('; ').find(row => row.startsWith('csrftoken='))?.split('=')[1];
            }

            function showToast(title, message, type = 'success') {
                const container = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;

                const icons = {
                    success: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg>',
                    error: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',
                    warning: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>'
                };

                toast.innerHTML = `
                    <div class="toast-icon">${icons[type] || icons.success}</div>
                    <div class="toast-content">
                        <div class="toast-title">${title}</div>
                        <div class="toast-message">${message}</div>
                    </div>
                    <button class="toast-close">&times;</button>
                `;

                container.appendChild(toast);
                setTimeout(() => toast.classList.add('show'), 10);
                const timeoutId = setTimeout(() => removeToast(toast), 3000);
                toast.querySelector('.toast-close').onclick = () => {
                    clearTimeout(timeoutId);
                    removeToast(toast);
                };
            }

            function removeToast(toast) {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 400);
            }

            // Open Modal Function
            function openModal(betType, number = null, title = 'Place a Bet') {
                currentBetType = betType;
                currentNumber = number;
                
                modal.classList.remove('hidden');
                modalTitle.textContent = title;
                
                // Reset form
                customAmountInput.value = '';
                amountButtons.forEach(b => b.classList.remove('selected'));
                
                // Reset selected columns when opening modal
                selectedAbrColumns = [];
                
                // Uncheck all checkboxes
                document.querySelectorAll('.betColumnCheckbox').forEach(cb => cb.checked = false);
                document.querySelectorAll('.jodiColumnCheckbox').forEach(cb => cb.checked = false);
                document.querySelectorAll('.abrCutColumnCheckbox').forEach(cb => cb.checked = false);
                document.querySelectorAll('.jodiPanelColumnCheckbox').forEach(cb => cb.checked = false);
                
                // Reset "Select All Columns" checkbox
                const selectAllCheckbox = document.getElementById('selectAllColumnsCheckbox');
                selectAllCheckbox.checked = false;
                
                // Show/hide specific options
                columnOptions.classList.add('hidden');
                jodiOptions.classList.add('hidden');
                ekiBekiOptions.classList.add('hidden');
                abrCutOptions.classList.add('hidden');
                jodiPanelOptions.classList.add('hidden');
                motarOptions.classList.add('hidden');
                commanPanaOptions.classList.add('hidden');
                setPanaOptions.classList.add('hidden');
                
                // Reset Motar input
                if (motarOptions) {
                    document.getElementById('motarNumberInput').value = '';
                    document.getElementById('motarGeneratedNumbers').classList.add('hidden');
                }
                
                // Reset Comman Pana input
                if (commanPanaOptions) {
                    document.getElementById('commanPanaDigitInput').value = '';
                    document.getElementById('commanPanaGeneratedNumbers').classList.add('hidden');
                }
                
                // Reset Set Pana input
                document.getElementById('setPanaNumberInput').value = '';
                document.getElementById('setPanaFamilyInfo').classList.add('hidden');
                
                // Show/hide "Select All Columns" checkbox (only for JODI, ABR_CUT, JODI_PANEL)
                // Note: DADAR is now part of EKI_BEKI dropdown, so it's handled differently
                const selectAllContainer = document.getElementById('selectAllColumnsContainer');
                if (['JODI', 'ABR_CUT', 'JODI_PANEL'].includes(betType)) {
                    selectAllContainer.classList.remove('hidden');
                } else {
                    selectAllContainer.classList.add('hidden');
                }
                
                if (betType === 'SINGLE' || betType === 'SP' || betType === 'DP') {
                    columnOptions.classList.remove('hidden');
                } else if (betType === 'JODI') {
                    jodiOptions.classList.remove('hidden');
                } else if (betType === 'EKI_BEKI') {
                    ekiBekiOptions.classList.remove('hidden');
                } else if (betType === 'ABR_CUT') {
                    abrCutOptions.classList.remove('hidden');
                } else if (betType === 'JODI_PANEL') {
                    jodiPanelOptions.classList.remove('hidden');
                } else if (betType === 'MOTAR') {
                    motarOptions.classList.remove('hidden');
                } else if (betType === 'COMMAN_PANA') {
                    commanPanaOptions.classList.remove('hidden');
                } else if (betType === 'SET_PANA') {
                    setPanaOptions.classList.remove('hidden');
                }
                
                // Switch to Place tab
                switchToPlaceTab();
                
                // Update undo button for all bet types
                updateUndoButton();
            }

            // Close Modal Function
            function closeModal() {
                modal.classList.add('hidden');
                currentBetType = null;
                currentNumber = null;
                selectedAbrColumns = [];
                
                // Uncheck all checkboxes
                document.querySelectorAll('.betColumnCheckbox').forEach(cb => cb.checked = false);
                document.querySelectorAll('.jodiColumnCheckbox').forEach(cb => cb.checked = false);
                document.querySelectorAll('.abrCutColumnCheckbox').forEach(cb => cb.checked = false);
                document.querySelectorAll('.jodiPanelColumnCheckbox').forEach(cb => cb.checked = false);
                
                // Reset Motar inputs
                document.getElementById('motarNumberInput').value = '';
                document.getElementById('motarGeneratedNumbers').classList.add('hidden');
                
                // Reset "Select All Columns" checkbox
                const selectAllCheckbox = document.getElementById('selectAllColumnsCheckbox');
                selectAllCheckbox.checked = false;
            }

            // Get selected columns from checkboxes
            function getSelectedColumns(checkboxClass) {
                const selected = [];
                document.querySelectorAll(`.${checkboxClass}:checked`).forEach(cb => {
                    selected.push(parseInt(cb.value));
                });
                return selected;
            }

            // Switch to Place Tab
            function switchToPlaceTab() {
                placeContent.classList.remove('hidden');
                historyContent.classList.add('hidden');
                placeTab.classList.add('border-indigo-600', 'text-indigo-600');
                historyTab.classList.remove('border-indigo-600', 'text-indigo-600');
            }

            // Switch to History Tab
            function switchToHistoryTab() {
                placeContent.classList.add('hidden');
                historyContent.classList.remove('hidden');
                historyTab.classList.add('border-indigo-600', 'text-indigo-600');
                placeTab.classList.remove('border-indigo-600', 'text-indigo-600');
                renderHistory();
            }

            // Update Undo Button Visibility
            function updateUndoButton() {
                // Handle Motar undo separately
                if (currentBetType === 'MOTAR' && lastMotarBets.length > 0) {
                    undoBtn.textContent = `Undo Last Motar (${lastMotarBets.length} bets)`;
                    undoBtn.classList.remove('hidden');
                    return;
                }
                
                // Handle Comman Pana undo separately
                if (currentBetType === 'COMMAN_PANA' && lastCommanPanaBets.length > 0) {
                    undoBtn.textContent = `Undo Last Comman Pana (${lastCommanPanaBets.length} bets)`;
                    undoBtn.classList.remove('hidden');
                    return;
                }
                
                // Reset button text for other types
                undoBtn.textContent = 'Undo Last Action';
                
                if (lastBulkAction && ['SP', 'DP', 'JODI', 'DADAR', 'EKI_BEKI', 'ABR_CUT', 'JODI_PANEL'].includes(currentBetType)) {
                    if (currentBetType === 'EKI_BEKI') {
                        // Only show undo for matching EKI/BEKI type
                        const selectedType = document.getElementById('ekiBekiType').value;
                        if (lastBulkAction.type === selectedType) {
                            undoBtn.classList.remove('hidden');
                            return;
                        }
                    } else {
                        // For SP, DP, JODI, DADAR, ABR_CUT, JODI_PANEL - show if last action matches current type
                        if (lastBulkAction.type === currentBetType) {
                            undoBtn.classList.remove('hidden');
                            return;
                        }
                    }
                }
                undoBtn.classList.add('hidden');
            }

            // Render History
            function renderHistory() {
                historyList.innerHTML = '';
                
                let relevantBets = [];
                
                if (currentBetType === 'SINGLE') {
                    const history = bets[currentNumber]?.history || [];
                    if (history.length === 0) {
                        historyList.innerHTML = '<div class="p-4 text-center text-gray-500">No bets yet.</div>';
                        return;
                    }
                    
                    history.forEach((bet, i) => {
                        const li = document.createElement('li');
                        li.classList.add('flex', 'flex-col', 'bg-gray-50', 'p-3', 'rounded', 'gap-1');
                        
                        const mainRow = document.createElement('div');
                        mainRow.classList.add('flex', 'justify-between', 'items-center');
                        
                        const infoDiv = document.createElement('div');
                        infoDiv.classList.add('flex', 'flex-col');
                        
                        const amountText = document.createElement('span');
                        amountText.classList.add('font-semibold');
                        amountText.textContent = `â‚¹${bet.amount}`;
                        
                        const metaText = document.createElement('span');
                        metaText.classList.add('text-xs', 'text-gray-500');
                        metaText.textContent = `${bet.created_at} â€¢ ${bet.bet_type || 'SINGLE'}`;
                        
                        infoDiv.append(amountText, metaText);
                        
                        const delBtn = document.createElement('button');
                        delBtn.textContent = 'Delete';
                        delBtn.classList.add('delete-button');
                        delBtn.onclick = async () => {
                            await deleteBet(bet.id, currentNumber);
                            renderHistory();
                        };
                        
                        mainRow.append(infoDiv, delBtn);
                        li.appendChild(mainRow);
                        historyList.appendChild(li);
                    });
                } else if (currentBetType === 'DADAR') {
                    const dadarNumbers = new Set([678, 345, 120, 789, 456, 123, 890, 567, 234, 190].map(String));
                    relevantBets = Object.entries(bets)
                        .filter(([number]) => dadarNumbers.has(number))
                        .flatMap(([number, data]) => 
                            data.history.map(bet => ({
                                ...bet,
                                number
                            }))
                        );
                    
                    if (relevantBets.length === 0) {
                        historyList.innerHTML = '<div class="p-4 text-center text-gray-500">No Dadar bets found</div>';
                        return;
                    }
                    
                    relevantBets.forEach((bet) => {
                        const li = document.createElement('li');
                        li.className = 'flex flex-col bg-gray-50 p-3 rounded gap-1';
                        
                        const mainRow = document.createElement('div');
                        mainRow.className = 'flex justify-between items-center';
                        
                        const infoDiv = document.createElement('div');
                        infoDiv.className = 'flex flex-col';
                        
                        const numberAmount = document.createElement('span');
                        numberAmount.className = 'font-semibold';
                        numberAmount.textContent = `${bet.number}: â‚¹${bet.amount}`;
                        
                        const metaText = document.createElement('span');
                        metaText.className = 'text-xs text-gray-500';
                        const columnInfo = bet.column ? `Col ${bet.column} â€¢ ` : '';
                        metaText.textContent = `${bet.created_at} â€¢ ${columnInfo}${bet.bet_type || 'DADAR'}`;
                        
                        infoDiv.append(numberAmount, metaText);
                        
                        const delBtn = document.createElement('button');
                        delBtn.textContent = 'Delete';
                        delBtn.className = 'delete-button';
                        delBtn.onclick = async () => {
                            await deleteBet(bet.id, bet.number);
                            renderHistory();
                        };
                        
                        mainRow.append(infoDiv, delBtn);
                        li.appendChild(mainRow);
                        historyList.appendChild(li);
                    });
                } else if (currentBetType === 'EKI_BEKI') {
                    const ekiBekiType = document.getElementById('ekiBekiType').value;
                    let targetNumbers;
                    if (ekiBekiType === 'EKI') {
                        targetNumbers = new Set([137, 135, 139, 157, 159, 179, 357, 359, 379, 579].map(String));
                    } else if (ekiBekiType === 'BEKI') {
                        targetNumbers = new Set([246, 248, 240, 268, 260, 280, 468, 460, 480, 680].map(String));
                    } else if (ekiBekiType === 'DADAR') {
                        targetNumbers = new Set([100, 110, 112, 113, 114, 115, 116, 117, 118, 119].map(String));
                    }
                    
                    relevantBets = Object.entries(bets)
                        .filter(([number]) => targetNumbers.has(number))
                        .flatMap(([number, data]) => 
                            data.history.map(bet => ({
                                ...bet,
                                number
                            }))
                        );
                    
                    if (relevantBets.length === 0) {
                        historyList.innerHTML = `<div class="p-4 text-center text-gray-500">No ${ekiBekiType} bets found</div>`;
                        return;
                    }
                    
                    relevantBets.forEach((bet) => {
                        const li = document.createElement('li');
                        li.className = 'flex flex-col bg-gray-50 p-3 rounded gap-1';
                        
                        const mainRow = document.createElement('div');
                        mainRow.className = 'flex justify-between items-center';
                        
                        const infoDiv = document.createElement('div');
                        infoDiv.className = 'flex flex-col';
                        
                        const numberAmount = document.createElement('span');
                        numberAmount.className = 'font-semibold';
                        numberAmount.textContent = `${bet.number}: â‚¹${bet.amount}`;
                        
                        const metaText = document.createElement('span');
                        metaText.className = 'text-xs text-gray-500';
                        metaText.textContent = `${bet.created_at} â€¢ ${bet.sub_type || bet.bet_type || ekiBekiType}`;
                        
                        infoDiv.append(numberAmount, metaText);
                        
                        const delBtn = document.createElement('button');
                        delBtn.textContent = 'Delete';
                        delBtn.className = 'delete-button';
                        delBtn.onclick = async () => {
                            await deleteBet(bet.id, bet.number);
                            renderHistory();
                        };
                        
                        mainRow.append(infoDiv, delBtn);
                        li.appendChild(mainRow);
                        historyList.appendChild(li);
                    });
                } else {
                    historyList.innerHTML = '<div class="p-4 text-center text-gray-500">No history available</div>';
                }
            }

            // API Functions
            async function loadBets() {
                try {
                    const res = await fetch(API.LOAD_BETS);
                    const data = await res.json();
                    if (data.success) {
                        bets = data.bets;
                        renderPage(1);
                    }
                } catch (err) {
                    console.error('Error loading bets:', err);
                }
            }

            async function getLastBulkAction() {
                try {
                    const res = await fetch(API.GET_LAST_BULK);
                    const data = await res.json();
                    lastBulkAction = data.has_action ? data.action : null;
                    updateUndoButton();
                } catch (err) {
                    console.error('Error getting last bulk:', err);
                }
            }

            async function placeSingleBet(number, amount) {
                showLoader('Placing bet...', 20);
                try {
                    updateLoader(40, 'Processing request...');
                    const res = await fetch(API.PLACE_BET, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCSRFToken() },
                        body: JSON.stringify({ number, amount })
                    });
                    updateLoader(70, 'Saving bet...');
                    const data = await res.json();
                    if (data.success) {
                        if (!bets[number]) bets[number] = { total: 0, history: [] };
                        bets[number].total += parseFloat(amount);
                        bets[number].history.push({ id: data.bet_id, amount: parseFloat(amount) });
                        updateBetTotal(number);
                        updateLoader(100, 'Complete!');
                    }
                    return data;
                } finally {
                    setTimeout(() => hideLoader(), 300);
                }
            }

            async function placeBulkBet(type, amount, column = null, jodiType = null, panelType = null) {
                showLoader(`Placing ${type} bets...`, 10);
                try {
                    const payload = { type, amount };
                    updateLoader(20, 'Preparing data...');
                    if (type === 'JODI') {
                        // Support both single column (number) and multiple columns (array)
                        payload.columns = Array.isArray(column) ? column : [column];
                        payload.jodi_type = jodiType;
                    } else if (type === 'DADAR') {
                        // Support both single column (number) and multiple columns (array)
                        payload.columns = Array.isArray(column) ? column : [column];
                    } else if (type === 'SINGLE' || type === 'SP' || type === 'DP') {
                        // Support both single column (number) and multiple columns (array)
                        if (column !== null) {
                            payload.columns = Array.isArray(column) ? column : [column];
                        }
                    } else if (type === 'ABR_CUT') {
                        // Support both single column (number) and multiple columns (array)
                        payload.columns = Array.isArray(column) ? column : [column];
                    } else if (type === 'JODI_PANEL') {
                        // Support both single column (number) and multiple columns (array)
                        payload.columns = Array.isArray(column) ? column : [column];
                        payload.panel_type = panelType;
                    }
                    updateLoader(40, 'Sending request...');
                    const res = await fetch(API.PLACE_BULK, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCSRFToken() },
                        body: JSON.stringify(payload)
                    });
                    updateLoader(60, 'Processing bets...');
                    const data = await res.json();
                    if (data.success) {
                        updateLoader(80, 'Updating totals...');
                        data.bets.forEach(bet => {
                            const num = bet.number;
                            if (!bets[num]) bets[num] = { total: 0, history: [] };
                            bets[num].total += parseFloat(bet.amount);
                            bets[num].history.push({ id: bet.id, amount: parseFloat(bet.amount) });
                            updateBetTotal(num);
                        });
                        lastBulkAction = { id: data.bulk_action_id, type, total_bets: data.total_bets };
                        updateLoader(100, 'Complete!');
                    }
                    return data;
                } finally {
                    setTimeout(() => hideLoader(), 300);
                }
            }

            async function deleteBet(betId, number) {
                const res = await fetch(API.DELETE_BET, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCSRFToken() },
                    body: JSON.stringify({ bet_id: betId })
                });
                const data = await res.json();
                if (data.success) {
                    const hist = bets[number]?.history;
                    if (hist) {
                        const idx = hist.findIndex(h => h.id === betId);
                        if (idx !== -1) {
                            bets[number].total -= hist[idx].amount;
                            hist.splice(idx, 1);
                        }
                        if (hist.length === 0) delete bets[number];
                    }
                    updateBetTotal(number);
                }
                return data;
            }

            async function undoBulkAction() {
                // Handle Motar undo
                if (currentBetType === 'MOTAR' && lastMotarBets.length > 0) {
                    if (!confirm(`Undo last Motar action (${lastMotarBets.length} bets)?`)) return;
                    
                    let successCount = 0;
                    let failCount = 0;
                    
                    for (const bet of lastMotarBets) {
                        const result = await deleteBet(bet.bet_id, bet.number);
                        if (result.success) {
                            successCount++;
                        } else {
                            failCount++;
                        }
                    }
                    
                    if (successCount > 0) {
                        showToast('Success', `${successCount} Motar bets undone`, 'success');
                        lastMotarBets = []; // Clear tracked bets
                        await updateTotalAmount();
                        renderPage(1);
                        updateUndoButton(); // Hide undo button
                    }
                    
                    if (failCount > 0) {
                        showToast('Warning', `Failed to undo ${failCount} bets`, 'warning');
                    }
                    
                    return;
                }
                
                // Handle Comman Pana undo
                if (currentBetType === 'COMMAN_PANA' && lastCommanPanaBets.length > 0) {
                    if (!confirm(`Undo last Comman Pana action (${lastCommanPanaBets.length} bets)?`)) return;
                    
                    let successCount = 0;
                    let failCount = 0;
                    
                    for (const bet of lastCommanPanaBets) {
                        const result = await deleteBet(bet.bet_id, bet.number);
                        if (result.success) {
                            successCount++;
                        } else {
                            failCount++;
                        }
                    }
                    
                    if (successCount > 0) {
                        showToast('Success', `${successCount} Comman Pana bets undone`, 'success');
                        lastCommanPanaBets = []; // Clear tracked bets
                        await updateTotalAmount();
                        renderPage(1);
                        updateUndoButton(); // Hide undo button
                    }
                    
                    if (failCount > 0) {
                        showToast('Warning', `Failed to undo ${failCount} bets`, 'warning');
                    }
                    
                    return;
                }
                
                // Handle bulk action undo
                if (!lastBulkAction) return showToast('Error', 'No bulk action to undo', 'warning');
                if (!confirm(`Undo last ${lastBulkAction.type} bulk action (${lastBulkAction.total_bets} bets)?`)) return;

                const res = await fetch(API.UNDO_BULK, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCSRFToken() },
                    body: JSON.stringify({ bulk_action_id: lastBulkAction.id })
                });
                const data = await res.json();
                if (data.success) {
                    showToast('Success', data.message, 'success');
                    await loadBets();
                    lastBulkAction = null;
                    await getLastBulkAction();
                    await updateTotalAmount();
                    closeModal();
                } else {
                    showToast('Error', data.message || 'Failed to undo', 'error');
                }
            }

            async function updateTotalAmount() {
                try {
                    const res = await fetch(API.GET_BET_TOTAL);
                    const data = await res.json();
                    if (data.success) {
                        const totalElement = document.getElementById('totalBalance');
                        totalElement.textContent = `â‚¹${parseFloat(data.total_amount).toLocaleString('en-IN')}`;
                    }
                } catch (err) {
                    console.error('Error fetching total amount:', err);
                }
            }

            function updateBetTotal(number) {
                const el = document.getElementById(`bet-total-${number}`);
                if (el) {
                    el.textContent = bets[number]?.total ? `â‚¹${bets[number].total}` : '';
                }
            }

            function renderPage(page) {
                tbody.innerHTML = '';
                const start = page === 1 ? 0 : 13;
                const end = page === 1 ? 11 : 22;

                const page1Btn = document.getElementById('page-1-btn');
                const page2Btn = document.getElementById('page-2-btn');

                if (page === 1) {
                    page1Btn.classList.add('bg-indigo-600', 'text-white');
                    page1Btn.classList.remove('bg-gray-300', 'text-gray-800');
                    page2Btn.classList.add('bg-gray-300', 'text-gray-800');
                    page2Btn.classList.remove('bg-indigo-600', 'text-white');
                } else {
                    page2Btn.classList.add('bg-indigo-600', 'text-white');
                    page2Btn.classList.remove('bg-gray-300', 'text-gray-800');
                    page1Btn.classList.add('bg-gray-300', 'text-gray-800');
                    page1Btn.classList.remove('bg-indigo-600', 'text-white');
                }

                for (let i = start; i <= end; i++) {
                    const row = document.createElement('tr');
                    const dataIndex = i > 12 ? i - 1 : i;
                    const rowNum = document.createElement('td');
                    rowNum.textContent = rowLabels[dataIndex] || (dataIndex + 1);
                    rowNum.classList.add('spreadsheet-cell', 'row-number-cell');
                    row.appendChild(rowNum);

                    for (let j = 0; j < 10; j++) {
                        const cell = document.createElement('td');
                        cell.classList.add('spreadsheet-cell', 'text-gray-700');
                        const value = allColumnData[j][dataIndex];

                        if (value) {
                            const span = document.createElement('span');
                            span.textContent = value;

                            const plus = document.createElement('button');
                            plus.textContent = '+';
                            plus.classList.add('bet-button');
                            plus.onclick = () => openModal('SINGLE', value, `Place a Bet on ${value}`);

                            const total = document.createElement('span');
                            total.classList.add('ml-2', 'text-sm', 'font-semibold', 'text-green-600');
                            total.id = `bet-total-${value}`;
                            if (bets[value]?.total) total.textContent = `â‚¹${bets[value].total}`;

                            cell.append(span, plus, total);
                        }
                        row.appendChild(cell);
                    }
                    tbody.appendChild(row);
                }
            }

            // Event Listeners

            // Amount button selection
            amountButtons.forEach(btn => {
                btn.onclick = () => {
                    amountButtons.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    customAmountInput.value = '';
                };
            });

            customAmountInput.addEventListener('input', () => {
                amountButtons.forEach(b => b.classList.remove('selected'));
            });

            // Modal close
            closeModalBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            modal.addEventListener('click', e => { if (e.target === modal) closeModal(); });

            // Tab switching
            placeTab.onclick = switchToPlaceTab;
            historyTab.onclick = switchToHistoryTab;

            // Confirm Bet
            confirmBtn.onclick = async () => {
                let amount = 0;
                const selected = document.querySelector('.amount-button.selected');
                if (selected) {
                    amount = parseFloat(selected.dataset.amount);
                } else {
                    amount = parseFloat(customAmountInput.value);
                }

                if (!amount || amount <= 0) {
                    return showToast('Invalid Amount', 'Please select or enter an amount', 'warning');
                }

                if (!selected) {
                    if (amount < 1) return showToast('Amount Too Low', 'Minimum is â‚¹1', 'warning');
                    if (amount > 5000) return showToast('Amount Too High', 'Maximum is â‚¹5,000', 'warning');
                }

                if (currentBetType === 'SINGLE') {
                    const result = await placeSingleBet(currentNumber, amount);
                    if (result.success) {
                        showToast('Success!', `Bet of â‚¹${amount} placed on ${currentNumber}`, 'success');
                        closeModal();
                        await updateTotalAmount();
                    } else {
                        showToast('Error', result.error || 'Failed to place bet', 'error');
                    }
                } else if (currentBetType === 'JODI') {
                    // Get selected columns from checkboxes
                    const columns = getSelectedColumns('jodiColumnCheckbox');
                    
                    if (columns.length === 0) {
                        return showToast('No Columns Selected', 'Please select at least one column', 'warning');
                    }
                    
                    const jodiType = parseInt(document.getElementById('jodiType').value);
                    
                    const result = await placeBulkBet('JODI', amount, columns, jodiType);
                    if (result.success) {
                        const columnText = columns.length > 1 
                            ? `${columns.length} columns (${columns.join(', ')})` 
                            : `Column ${columns[0]}`;
                        showToast('Success!', `Jodi Vagar ${jodiType} bet placed on ${columnText}: ${result.total_bets} numbers`, 'success');
                        closeModal();
                        renderPage(1);
                        await getLastBulkAction();
                        await updateTotalAmount();
                    } else {
                        showToast('Error', result.error || 'Failed to place Jodi bet', 'error');
                    }
                } else if (currentBetType === 'EKI_BEKI') {
                    const ekiBekiType = document.getElementById('ekiBekiType').value;
                    
                    // Handle all types (EKI, BEKI, DADAR) the same way - no column selection
                    const result = await placeBulkBet(ekiBekiType, amount);
                    if (result.success) {
                        showToast('Success!', `${ekiBekiType} bet placed on ${result.total_bets} numbers`, 'success');
                        closeModal();
                        renderPage(1);
                        await getLastBulkAction();
                        await updateTotalAmount();
                    } else {
                        showToast('Error', result.error || 'Failed to place bet', 'error');
                    }
                } else if (currentBetType === 'ABR_CUT') {
                    // Get selected columns from checkboxes
                    const columns = getSelectedColumns('abrCutColumnCheckbox');
                    
                    if (columns.length === 0) {
                        return showToast('No Columns Selected', 'Please select at least one column', 'warning');
                    }
                    
                    const result = await placeBulkBet('ABR_CUT', amount, columns);
                    if (result.success) {
                        const columnText = columns.length > 1 
                            ? `${columns.length} columns (${columns.join(', ')})` 
                            : `Column ${columns[0]}`;
                        showToast('Success!', `ABR Cut bet placed on ${columnText}: ${result.total_bets} numbers`, 'success');
                        closeModal();
                        renderPage(1);
                        await getLastBulkAction();
                        await updateTotalAmount();
                    } else {
                        showToast('Error', result.error || 'Failed to place ABR Cut bet', 'error');
                    }
                } else if (currentBetType === 'JODI_PANEL') {
                    // Get selected columns from checkboxes
                    const columns = getSelectedColumns('jodiPanelColumnCheckbox');
                    
                    if (columns.length === 0) {
                        return showToast('No Columns Selected', 'Please select at least one column', 'warning');
                    }
                    
                    const panelType = parseInt(document.getElementById('jodiPanelType').value);
                    
                    const result = await placeBulkBet('JODI_PANEL', amount, columns, null, panelType);
                    if (result.success) {
                        const columnText = columns.length > 1 
                            ? `${columns.length} columns (${columns.join(', ')})` 
                            : `Column ${columns[0]}`;
                        showToast('Success!', `Jodi Panel ${panelType} bet placed on ${columnText}: ${result.total_bets} numbers`, 'success');
                        closeModal();
                        renderPage(1);
                        await getLastBulkAction();
                        await updateTotalAmount();
                    } else {
                        showToast('Error', result.error || 'Failed to place Jodi Panel bet', 'error');
                    }
                } else if (['SP', 'DP'].includes(currentBetType)) {
                    // Get selected columns from checkboxes based on bet type
                    let columns = null;
                    // For SP/DP, columns are optional
                    columns = getSelectedColumns('betColumnCheckbox');
                    columns = columns.length > 0 ? columns : null;
                    
                    const result = await placeBulkBet(currentBetType, amount, columns);
                    if (result.success) {
                        let message = `${result.total_bets} bets placed successfully`;
                        if (columns && columns.length > 0) {
                            const columnText = columns.length > 1 
                                ? `${columns.length} columns (${columns.join(', ')})` 
                                : `Column ${columns[0]}`;
                            message = `${currentBetType} bet placed on ${columnText}: ${result.total_bets} numbers`;
                        }
                        showToast('Success!', message, 'success');
                        closeModal();
                        renderPage(currentBetType === 'SP' ? 1 : 2);
                        await getLastBulkAction();
                        await updateTotalAmount();
                    } else {
                        showToast('Error', result.error || 'Failed to place bets', 'error');
                    }
                } else if (currentBetType === 'MOTAR') {
                    const motarInput = document.getElementById('motarNumberInput').value;
                    
                    if (!motarInput || motarInput.length < 4 || motarInput.length > 10) {
                        return showToast('Invalid Input', 'Please enter a 4-10 digit number', 'warning');
                    }
                    
                    try {
                        // Call Django API to place all Motar bets in one transaction
                        const res = await fetch(API.PLACE_MOTAR, {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCSRFToken()
                            },
                            body: JSON.stringify({ 
                                digits: motarInput,
                                amount: amount
                            })
                        });
                        
                        const data = await res.json();
                        
                        if (data.success) {
                            // Update frontend bets
                            lastMotarBets = []; // Clear previous tracking
                            
                            data.bets.forEach(bet => {
                                const num = bet.number;
                                if (!bets[num]) bets[num] = { total: 0, history: [] };
                                bets[num].total += parseFloat(bet.amount);
                                bets[num].history.push({ 
                                    id: bet.bet_id, 
                                    amount: parseFloat(bet.amount),
                                    bet_type: 'MOTAR'
                                });
                                updateBetTotal(num);
                                
                                // Track for undo
                                lastMotarBets.push({
                                    bet_id: bet.bet_id,
                                    number: bet.number,
                                    amount: parseFloat(bet.amount)
                                });
                            });
                            
                            // Update last bulk action
                            lastBulkAction = { 
                                id: data.bulk_action_id, 
                                type: 'MOTAR', 
                                total_bets: data.total_bets 
                            };
                            
                            showToast('Success!', `Motar: ${data.total_bets} bets placed from ${motarInput}`, 'success');
                            closeModal();
                            renderPage(1);
                            await updateTotalAmount();
                            updateUndoButton();
                        } else {
                            showToast('Error', data.error || 'Failed to place Motar bets', 'error');
                        }
                    } catch (err) {
                        console.error('Error placing Motar bets:', err);
                        showToast('Error', 'Failed to place Motar bets', 'error');
                    }
                } else if (currentBetType === 'COMMAN_PANA') {
                    const digitInput = document.getElementById('commanPanaDigitInput').value;
                    const is36Checked = document.getElementById('commanPana36Checkbox').checked;
                    const is56Checked = document.getElementById('commanPana56Checkbox').checked;
                    
                    if (!digitInput || digitInput.length !== 1 || !/^[0-9]$/.test(digitInput)) {
                        return showToast('Invalid Input', 'Please enter a single digit (0-9)', 'warning');
                    }
                    
                    if (!is36Checked && !is56Checked) {
                        return showToast('Select Type', 'Please select Common Pana 36 or 56', 'warning');
                    }
                    
                    const betType = is56Checked ? '56' : '36';
                    const betTypeName = is56Checked ? 'COMMAN_PANA_56' : 'COMMAN_PANA_36';
                    const betLabel = is56Checked ? 'Common Pana 56' : 'Common Pana 36';
                    
                    try {
                        // Call Django API to place all Common Pana bets in one transaction
                        const res = await fetch(API.PLACE_COMMAN_PANA, {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCSRFToken()
                            },
                            body: JSON.stringify({ 
                                digit: parseInt(digitInput),
                                amount: amount,
                                type: betType
                            })
                        });
                        
                        const data = await res.json();
                        
                        if (data.success) {
                            // Update frontend bets
                            lastCommanPanaBets = []; // Clear previous tracking
                            
                            data.bets.forEach(bet => {
                                const num = bet.number;
                                if (!bets[num]) bets[num] = { total: 0, history: [] };
                                bets[num].total += parseFloat(bet.amount);
                                bets[num].history.push({ 
                                    id: bet.bet_id, 
                                    amount: parseFloat(bet.amount),
                                    bet_type: betTypeName
                                });
                                updateBetTotal(num);
                                
                                // Track for undo
                                lastCommanPanaBets.push({
                                    bet_id: bet.bet_id,
                                    number: bet.number,
                                    amount: parseFloat(bet.amount)
                                });
                            });
                            
                            // Update last bulk action
                            lastBulkAction = { 
                                id: data.bulk_action_id, 
                                type: betTypeName, 
                                total_bets: data.total_bets 
                            };
                            
                            showToast('Success!', `${betLabel}: ${data.total_bets} bets placed for digit ${digitInput}`, 'success');
                            closeModal();
                            renderPage(1);
                            await updateTotalAmount();
                            updateUndoButton();
                        } else {
                            showToast('Error', data.error || 'Failed to place Common Pana bets', 'error');
                        }
                    } catch (err) {
                        console.error('Error placing Common Pana bets:', err);
                        showToast('Error', 'Failed to place Common Pana bets', 'error');
                    }
                } else if (currentBetType === 'SET_PANA') {
                    const numberInput = document.getElementById('setPanaNumberInput').value;
                    
                    if (!numberInput || numberInput.length !== 3 || !/^[0-9]{3}$/.test(numberInput)) {
                        return showToast('Invalid Input', 'Please enter exactly 3 digits', 'warning');
                    }
                    
                    // Check if family info is displayed (means number is valid)
                    const familyInfoDiv = document.getElementById('setPanaFamilyInfo');
                    if (familyInfoDiv.classList.contains('hidden')) {
                        return showToast('Invalid Number', 'Number not found in any family group', 'warning');
                    }
                    
                    const familyName = document.getElementById('setPanaFamilyName').textContent;
                    
                    try {
                        // Call Django API to place all Set Pana bets in one transaction
                        const res = await fetch(API.PLACE_SET_PANA, {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCSRFToken()
                            },
                            body: JSON.stringify({ 
                                number: parseInt(numberInput),
                                amount: amount
                            })
                        });
                        
                        const data = await res.json();
                        
                        if (data.success) {
                            // Update frontend bets
                            data.bets.forEach(bet => {
                                const num = bet.number;
                                if (!bets[num]) bets[num] = { total: 0, history: [] };
                                bets[num].total += parseFloat(bet.amount);
                                bets[num].history.push({ 
                                    id: bet.bet_id, 
                                    amount: parseFloat(bet.amount),
                                    bet_type: 'SET_PANA'
                                });
                                updateBetTotal(num);
                            });
                            
                            // Update last bulk action
                            lastBulkAction = { 
                                id: data.bulk_action_id, 
                                type: 'SET_PANA', 
                                total_bets: data.total_bets 
                            };
                            
                            showToast('Success!', `Set Pana: ${data.total_bets} bets placed for family ${familyName}`, 'success');
                            closeModal();
                            renderPage(1);
                            await getLastBulkAction();
                            await updateTotalAmount();
                            updateUndoButton();
                        } else {
                            showToast('Error', data.error || 'Failed to place Set Pana bets', 'error');
                        }
                    } catch (err) {
                        console.error('Error placing Set Pana bets:', err);
                        showToast('Error', 'Failed to place Set Pana bets', 'error');
                    }
                }
            };

            // Undo button
            undoBtn.onclick = undoBulkAction;

            // Eki/Beki/Dadar type change listener to update undo button
            document.getElementById('ekiBekiType').addEventListener('change', function() {
                updateUndoButton();
            });

            // "Select All Columns" checkbox event listener
            document.getElementById('selectAllColumnsCheckbox').addEventListener('change', function() {
                let checkboxClass;
                
                // Determine which checkboxes to select based on current bet type
                if (currentBetType === 'ABR_CUT') {
                    checkboxClass = 'abrCutColumnCheckbox';
                } else if (currentBetType === 'JODI') {
                    checkboxClass = 'jodiColumnCheckbox';
                } else if (currentBetType === 'JODI_PANEL') {
                    checkboxClass = 'jodiPanelColumnCheckbox';
                } else {
                    return;
                }
                
                if (this.checked) {
                    // Check all checkboxes
                    document.querySelectorAll(`.${checkboxClass}`).forEach(cb => {
                        cb.checked = true;
                    });
                    showToast('All Columns Selected', 'All 10 columns have been selected', 'success');
                } else {
                    // Uncheck all checkboxes
                    document.querySelectorAll(`.${checkboxClass}`).forEach(cb => {
                        cb.checked = false;
                    });
                    showToast('Columns Cleared', 'All columns have been deselected', 'success');
                }
            });

            // Page navigation
            document.getElementById('page-1-btn').onclick = () => renderPage(1);
            document.getElementById('page-2-btn').onclick = () => renderPage(2);

            // Bet action buttons
            document.getElementById('all-sp-btn').onclick = () => {
                openModal('SP', null, 'Place Bet on ALL SP (120 numbers)');
            };

            document.getElementById('all-dp-btn').onclick = () => {
                openModal('DP', null, 'Place Bet on ALL DP (100 numbers)');
            };

            document.getElementById('jodi-btn').onclick = () => {
                openModal('JODI', null, 'Jodi Vagar');
            };

            document.getElementById('eki-beki-btn').onclick = () => {
                openModal('EKI_BEKI', null, 'Eki/Beki/Dadar');
            };

            document.getElementById('abr-cut-btn').onclick = () => {
                openModal('ABR_CUT', null, 'ABR Cut');
            };

            document.getElementById('jodi-panel-btn').onclick = () => {
                openModal('JODI_PANEL', null, 'Jodi Panel');
            };

            document.getElementById('motar-btn').onclick = () => {
                openModal('MOTAR', null, 'Motar');
            };

            document.getElementById('comman-pana-btn').onclick = () => {
                openModal('COMMAN_PANA', null, 'Comman Pana 36');
            };

            document.getElementById('set-pana-btn').onclick = () => {
                openModal('SET_PANA', null, 'Set Pana');
            };

            // Motar number input handler - call Django API for preview
            document.getElementById('motarNumberInput').addEventListener('input', async function(e) {
                let value = e.target.value.replace(/[^0-9]/g, ''); // Only allow digits
                e.target.value = value;
                
                const generatedDiv = document.getElementById('motarGeneratedNumbers');
                const displayDiv = document.getElementById('motarNumbersDisplay');
                const countSpan = document.getElementById('motarNumbersCount');
                
                if (value.length >= 4 && value.length <= 10) {
                    try {
                        // Call Django API to generate numbers
                        const res = await fetch(API.GENERATE_MOTAR, {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCSRFToken()
                            },
                            body: JSON.stringify({ digits: value })
                        });
                        
                        const data = await res.json();
                        
                        if (data.success) {
                            const numbers = data.numbers;
                            
                            // Display generated numbers
                            displayDiv.innerHTML = numbers.map(num => 
                                `<span class="px-2 py-1 bg-orange-100 text-orange-800 rounded text-sm font-mono">${num}</span>`
                            ).join('');
                            
                            countSpan.textContent = numbers.length;
                            generatedDiv.classList.remove('hidden');
                        } else {
                            generatedDiv.classList.add('hidden');
                        }
                    } catch (err) {
                        console.error('Error generating Motar numbers:', err);
                        generatedDiv.classList.add('hidden');
                    }
                } else {
                    generatedDiv.classList.add('hidden');
                }
            });

            // Comman Pana digit input handler - call Django API for preview
            document.getElementById('commanPanaDigitInput').addEventListener('input', async function(e) {
                let value = e.target.value.replace(/[^0-9]/g, ''); // Only allow digits
                if (value.length > 1) value = value.slice(0, 1); // Limit to 1 digit
                e.target.value = value;
                
                const generatedDiv = document.getElementById('commanPanaGeneratedNumbers');
                const displayDiv = document.getElementById('commanPanaNumbersDisplay');
                const countSpan = document.getElementById('commanPanaNumbersCount');
                
                if (value.length === 1) {
                    // Check which type is selected
                    const is36Checked = document.getElementById('commanPana36Checkbox').checked;
                    const is56Checked = document.getElementById('commanPana56Checkbox').checked;
                    
                    if (!is36Checked && !is56Checked) {
                        showToast('Select Type', 'Please select Common Pana 36 or 56', 'warning');
                        return;
                    }
                    
                    const betType = is56Checked ? '56' : '36';
                    
                    try {
                        // Call Django API to find numbers
                        const res = await fetch(API.FIND_COMMAN_PANA, {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCSRFToken()
                            },
                            body: JSON.stringify({ 
                                digit: parseInt(value),
                                type: betType
                            })
                        });
                        
                        const data = await res.json();
                        
                        if (data.success) {
                            const numbers = data.numbers;
                            
                            // Display found numbers
                            displayDiv.innerHTML = numbers.map(num => 
                                `<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm font-mono">${num}</span>`
                            ).join('');
                            
                            countSpan.textContent = numbers.length;
                            generatedDiv.classList.remove('hidden');
                        } else {
                            generatedDiv.classList.add('hidden');
                        }
                    } catch (err) {
                        console.error('Error finding Common Pana numbers:', err);
                        generatedDiv.classList.add('hidden');
                    }
                } else {
                    generatedDiv.classList.add('hidden');
                }
            });
            
            // Add checkbox change listeners for Common Pana types
            document.getElementById('commanPana36Checkbox').addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('commanPana56Checkbox').checked = false;
                }
                // Trigger digit input to refresh numbers
                const digitInput = document.getElementById('commanPanaDigitInput');
                if (digitInput.value) {
                    digitInput.dispatchEvent(new Event('input'));
                }
            });
            
            document.getElementById('commanPana56Checkbox').addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('commanPana36Checkbox').checked = false;
                }
                // Trigger digit input to refresh numbers
                const digitInput = document.getElementById('commanPanaDigitInput');
                if (digitInput.value) {
                    digitInput.dispatchEvent(new Event('input'));
                }
            });

            // Set Pana number input handler - show family information
            document.getElementById('setPanaNumberInput').addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^0-9]/g, ''); // Only allow digits
                e.target.value = value;
                
                const familyInfoDiv = document.getElementById('setPanaFamilyInfo');
                const familyNameSpan = document.getElementById('setPanaFamilyName');
                const familyNumbersDiv = document.getElementById('setPanaFamilyNumbers');
                const countSpan = document.getElementById('setPanaFamilyCount');
                
                if (value.length === 3) {
                    // Find which family this number belongs to
                    const familyPanaNumbers = {
                        'G1': [678, 123, 137, 268, 236, 178, 128, 367],
                        'G2': [345, 890, 390, 458, 480, 359, 589, 340],
                        'G3': [120, 567, 157, 260, 256, 170, 670, 125],
                        'G4': [789, 234, 239, 478, 248, 379, 347, 289],
                        'G5': [456, 190, 140, 569, 159, 460, 690, 145],
                        'G6': [245, 290, 470, 579, 790, 457, 259, 240],
                        'G7': [129, 147, 246, 679, 467, 269, 179, 124],
                        'G8': [139, 148, 346, 689, 468, 369, 189, 134],
                        'G9': [130, 158, 356, 680, 568, 360, 180, 135],
                        'G10': [230, 258, 357, 780, 578, 370, 280, 235],
                        'G11': [146, 119, 669, 169, 466, 114],
                        'G12': [138, 336, 688, 368, 188, 133],
                        'G13': [238, 337, 788, 378, 288, 233],
                        'G14': [149, 446, 699, 469, 199, 144],
                        'G15': [168, 113, 366, 136, 668, 118],
                        'G16': [380, 335, 588, 358, 880, 330],
                        'G17': [156, 110, 660, 160, 566, 115],
                        'G18': [247, 229, 779, 279, 477, 224],
                        'G19': [167, 112, 266, 126, 667, 117],
                        'G20': [249, 447, 799, 479, 299, 244],
                        'G21': [489, 344, 399, 349, 899, 448],
                        'G22': [570, 255, 200, 250, 700, 557],
                        'G23': [490, 445, 599, 459, 990, 440],
                        'G24': [257, 220, 770, 270, 577, 225],
                        'G25': [267, 122, 177, 127, 677, 226],
                        'G26': [560, 100, 155, 150, 556, 600],
                        'G27': [237, 228, 778, 278, 377, 223],
                        'G28': [580, 300, 355, 350, 558, 800],
                        'G29': [590, 400, 455, 450, 559, 900],
                        'G30': [348, 339, 889, 389, 488, 334],
                        'G31': [227, 777, 277, 222],
                        'G32': [499, 444, 449, 999],
                        'G33': [166, 111, 116, 666],
                        'G34': [338, 888, 388, 333],
                        'G35': [500, 555, 550, 0]
                    };
                    
                    const numberInt = parseInt(value);
                    let foundFamily = null;
                    let foundNumbers = [];
                    
                    for (const [family, numbers] of Object.entries(familyPanaNumbers)) {
                        if (numbers.includes(numberInt)) {
                            foundFamily = family;
                            foundNumbers = numbers;
                            break;
                        }
                    }
                    
                    if (foundFamily) {
                        familyNameSpan.textContent = foundFamily;
                        familyNumbersDiv.innerHTML = foundNumbers.map(num => 
                            `<span class="px-2 py-1 ${num === numberInt ? 'bg-indigo-200 font-bold' : 'bg-indigo-100'} text-indigo-800 rounded text-sm font-mono">${String(num).padStart(3, '0')}</span>`
                        ).join('');
                        countSpan.textContent = foundNumbers.length;
                        familyInfoDiv.classList.remove('hidden');
                    } else {
                        familyInfoDiv.classList.add('hidden');
                        showToast('Invalid Number', `Number ${value} is not in any family group`, 'error');
                    }
                } else {
                    familyInfoDiv.classList.add('hidden');
                }
            });

            // Add event listeners to all column checkboxes for visual feedback
            function addCheckboxListeners(checkboxClass, highlightColor) {
                document.querySelectorAll(`.${checkboxClass}`).forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const label = this.closest('label');
                        if (this.checked) {
                            label.classList.add(`border-${highlightColor}-500`, `bg-${highlightColor}-50`);
                            label.classList.remove('border-gray-300');
                        } else {
                            label.classList.remove(`border-${highlightColor}-500`, `bg-${highlightColor}-50`);
                            label.classList.add('border-gray-300');
                        }
                    });
                });
            }

            // Add listeners for all checkbox types
            addCheckboxListeners('betColumnCheckbox', 'indigo');
            addCheckboxListeners('jodiColumnCheckbox', 'purple');
            addCheckboxListeners('abrCutColumnCheckbox', 'pink');
            addCheckboxListeners('jodiPanelColumnCheckbox', 'teal');

            // Quick Bet Entry functionality
            let quickBetRowCounter = 2;
            const validNumbers = new Set();
            
            // Build valid numbers set from ALL_COLUMN_DATA (already defined above)
            allColumnData.forEach(column => {
                column.forEach(num => {
                    const numStr = String(num);
                    if (numStr.length === 3) {
                        validNumbers.add(numStr);
                    }
                });
            });

            // Handle number input - validate 3-digit number from ALL_COLUMN_DATA
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('quick-bet-number')) {
                    const input = e.target;
                    const rowNum = input.dataset.row;
                    
                    // Only allow digits
                    input.value = input.value.replace(/[^0-9]/g, '');
                    
                    // Check if it's a valid 3-digit number
                    if (input.value.length === 3) {
                        if (!validNumbers.has(input.value)) {
                            input.classList.add('border-red-500', 'bg-red-50');
                            showToast('Invalid Number', `${input.value} is not in the allowed numbers list`, 'error');
                        } else {
                            input.classList.remove('border-red-500', 'bg-red-50');
                            input.classList.add('border-green-500', 'bg-green-50');
                        }
                    } else {
                        input.classList.remove('border-red-500', 'bg-red-50', 'border-green-500', 'bg-green-50');
                    }
                    
                    // Auto-add new row when user starts typing in the last row
                    const allRows = document.querySelectorAll('#quickBetTableBody tr');
                    const lastRow = allRows[allRows.length - 1];
                    const lastRowNum = parseInt(lastRow.dataset.row);
                    
                    if (parseInt(rowNum) === lastRowNum && input.value.length > 0) {
                        addQuickBetRow();
                    }
                }
            });

            // Add new row to quick bet table
            function addQuickBetRow() {
                quickBetRowCounter++;
                const tbody = document.getElementById('quickBetTableBody');
                const newRow = document.createElement('tr');
                newRow.dataset.row = quickBetRowCounter;
                newRow.innerHTML = `
                    <td class="border border-gray-300 px-2 py-2 text-center text-sm font-medium text-gray-600">${quickBetRowCounter}</td>
                    <td class="border border-gray-300 p-1">
                        <input type="text" 
                            class="quick-bet-number w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                            placeholder="3-digit" 
                            maxlength="3"
                            data-row="${quickBetRowCounter}">
                    </td>
                    <td class="border border-gray-300 p-1">
                        <input type="number" 
                            class="quick-bet-amount w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                            placeholder="Amount"
                            min="1"
                            data-row="${quickBetRowCounter}">
                    </td>
                    <td class="border border-gray-300 p-1 text-center">
                        <button class="remove-row-btn text-red-500 hover:text-red-700 hover:bg-red-50 rounded p-1 transition" title="Remove row">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </td>
                `;
                tbody.appendChild(newRow);
            }

            // Remove row button event listener (event delegation)
            document.getElementById('quickBetTableBody').addEventListener('click', function(e) {
                const removeBtn = e.target.closest('.remove-row-btn');
                if (removeBtn) {
                    const row = removeBtn.closest('tr');
                    const tbody = document.getElementById('quickBetTableBody');
                    
                    // Prevent removing if only one row left
                    if (tbody.querySelectorAll('tr').length <= 1) {
                        showToast('Cannot Remove', 'At least one row must remain', 'warning');
                        return;
                    }
                    
                    row.remove();
                    
                    // Re-number remaining rows
                    const remainingRows = tbody.querySelectorAll('tr');
                    remainingRows.forEach((row, index) => {
                        const rowNum = index + 1;
                        row.dataset.row = rowNum;
                        row.querySelector('td:first-child').textContent = rowNum;
                        row.querySelectorAll('input').forEach(input => {
                            input.dataset.row = rowNum;
                        });
                    });
                    
                    // Update counter to match the highest row number
                    quickBetRowCounter = remainingRows.length;
                }
            });

            // Place bets button
            document.getElementById('quickBetOkayBtn').addEventListener('click', async function() {
                const numberInputs = document.querySelectorAll('.quick-bet-number');
                const amountInputs = document.querySelectorAll('.quick-bet-amount');
                
                const betsToPlace = [];
                
                for (let i = 0; i < numberInputs.length; i++) {
                    const number = numberInputs[i].value.trim();
                    const amount = amountInputs[i].value.trim();
                    
                    if (number && amount) {
                        // Validate number
                        if (number.length !== 3) {
                            showToast('Invalid Entry', `Row ${i + 1}: Number must be 3 digits`, 'error');
                            return;
                        }
                        
                        if (!validNumbers.has(number)) {
                            showToast('Invalid Number', `Row ${i + 1}: ${number} is not allowed`, 'error');
                            return;
                        }
                        
                        // Validate amount
                        const amountNum = parseFloat(amount);
                        if (isNaN(amountNum) || amountNum <= 0) {
                            showToast('Invalid Amount', `Row ${i + 1}: Amount must be greater than 0`, 'error');
                            return;
                        }
                        
                        betsToPlace.push({ number, amount: amountNum });
                    } else if (number || amount) {
                        // One field filled but not the other
                        showToast('Incomplete Entry', `Row ${i + 1}: Please fill both number and amount`, 'warning');
                        return;
                    }
                }
                
                if (betsToPlace.length === 0) {
                    showToast('No Bets', 'Please enter at least one bet', 'warning');
                    return;
                }
                
                // Place all bets
                let successCount = 0;
                let failCount = 0;
                const failedBets = [];
                
                for (const bet of betsToPlace) {
                    try {
                        const response = await fetch(API.PLACE_BET, {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCSRFToken()
                            },
                            body: JSON.stringify({
                                number: bet.number,
                                amount: bet.amount
                            })
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            successCount++;
                            
                            // Update bets dictionary like the main placeSingleBet function does
                            const num = bet.number;
                            if (!bets[num]) bets[num] = { total: 0, history: [] };
                            bets[num].total += parseFloat(bet.amount);
                            bets[num].history.push({ 
                                id: result.bet_id, 
                                amount: parseFloat(bet.amount),
                                created_at: new Date().toISOString(),
                                bet_type: 'SINGLE'
                            });
                            updateBetTotal(num);
                        } else {
                            failCount++;
                            failedBets.push(`${bet.number} (â‚¹${bet.amount})`);
                            console.error('Bet failed:', result.error || 'Unknown error');
                        }
                    } catch (error) {
                        failCount++;
                        failedBets.push(`${bet.number} (â‚¹${bet.amount})`);
                        console.error('Bet error:', error);
                    }
                }
                
                // Show result
                if (successCount > 0 && failCount === 0) {
                    showToast('Success!', `${successCount} bet(s) placed successfully`, 'success');
                    
                    // Clear the table
                    document.getElementById('quickBetClearBtn').click();
                    
                    // Reload bets and update total
                    await loadBets();
                    await updateTotalAmount();
                    renderPage(1);
                } else if (successCount > 0 && failCount > 0) {
                    showToast('Partial Success', `${successCount} bet(s) placed, ${failCount} failed: ${failedBets.join(', ')}`, 'warning');
                    
                    // Reload bets and update total
                    await loadBets();
                    await updateTotalAmount();
                    renderPage(1);
                } else if (failCount > 0) {
                    showToast('Failed', `All ${failCount} bet(s) failed to place: ${failedBets.join(', ')}`, 'error');
                }
            });

            // Clear button
            document.getElementById('quickBetClearBtn').addEventListener('click', function() {
                const tbody = document.getElementById('quickBetTableBody');
                tbody.innerHTML = `
                    <tr data-row="1">
                        <td class="border border-gray-300 px-2 py-2 text-center text-sm font-medium text-gray-600">1</td>
                        <td class="border border-gray-300 p-1">
                            <input type="text" 
                                class="quick-bet-number w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                                placeholder="3-digit" 
                                maxlength="3"
                                data-row="1">
                        </td>
                        <td class="border border-gray-300 p-1">
                            <input type="number" 
                                class="quick-bet-amount w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                                placeholder="Amount"
                                min="1"
                                data-row="1">
                        </td>
                        <td class="border border-gray-300 p-1 text-center">
                            <button class="remove-row-btn text-red-500 hover:text-red-700 hover:bg-red-50 rounded p-1 transition" title="Remove row">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                    <tr data-row="2">
                        <td class="border border-gray-300 px-2 py-2 text-center text-sm font-medium text-gray-600">2</td>
                        <td class="border border-gray-300 p-1">
                            <input type="text" 
                                class="quick-bet-number w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                                placeholder="3-digit" 
                                maxlength="3"
                                data-row="2">
                        </td>
                        <td class="border border-gray-300 p-1">
                            <input type="number" 
                                class="quick-bet-amount w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                                placeholder="Amount"
                                min="1"
                                data-row="2">
                        </td>
                        <td class="border border-gray-300 p-1 text-center">
                            <button class="remove-row-btn text-red-500 hover:text-red-700 hover:bg-red-50 rounded p-1 transition" title="Remove row">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                `;
                quickBetRowCounter = 2;
            });

            // Toggle Quick Bet Container
            document.getElementById('toggleQuickBetBtn').addEventListener('click', function() {
                const container = document.getElementById('quickBetContainer');
                container.classList.toggle('hidden');
            });

            document.getElementById('closeQuickBetBtn').addEventListener('click', function() {
                document.getElementById('quickBetContainer').classList.add('hidden');
            });

            // History Modal Functions
            const historyModal = document.getElementById('historyModal');
            const historyTableBody = document.getElementById('historyTableBody');

            async function loadBulkActionHistory() {
                try {
                    const res = await fetch(API.GET_BULK_HISTORY);
                    const data = await res.json();
                    
                    if (data.success) {
                        renderHistoryTable(data.history);
                        updateHistoryStats(data.history);
                    } else {
                        showToast('Error', 'Failed to load history', 'error');
                    }
                } catch (err) {
                    console.error('Error loading history:', err);
                    showToast('Error', 'Failed to load history', 'error');
                }
            }

            function renderHistoryTable(history) {
                historyTableBody.innerHTML = '';
                
                if (history.length === 0) {
                    historyTableBody.innerHTML = `
                        <tr>
                            <td colspan="9" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                                No history records found
                            </td>
                        </tr>
                    `;
                    return;
                }

                history.forEach((record, index) => {
                    const row = document.createElement('tr');
                    row.className = index % 2 === 0 ? 'bg-white hover:bg-purple-50' : 'bg-gray-50 hover:bg-purple-50';
                    
                    // Action type with color coding
                    let actionTypeClass = 'bg-gray-100 text-gray-800';
                    if (record.action_type === 'SP') actionTypeClass = 'bg-lime-100 text-lime-800';
                    else if (record.action_type === 'DP') actionTypeClass = 'bg-blue-100 text-blue-800';
                    else if (record.action_type === 'JODI') actionTypeClass = 'bg-purple-100 text-purple-800';
                    else if (record.action_type === 'EKI') actionTypeClass = 'bg-cyan-100 text-cyan-800';
                    else if (record.action_type === 'BEKI') actionTypeClass = 'bg-cyan-100 text-cyan-800';
                    else if (record.action_type === 'DADAR') actionTypeClass = 'bg-yellow-100 text-yellow-800';
                    else if (record.action_type === 'ABR_CUT') actionTypeClass = 'bg-pink-100 text-pink-800';
                    else if (record.action_type === 'JODI_PANEL') actionTypeClass = 'bg-teal-100 text-teal-800';
                    else if (record.action_type === 'MOTAR') actionTypeClass = 'bg-orange-100 text-orange-800';
                    else if (record.action_type === 'COMMAN_PANA_36') actionTypeClass = 'bg-blue-100 text-blue-800';
                    else if (record.action_type === 'COMMAN_PANA_56') actionTypeClass = 'bg-indigo-100 text-indigo-800';
                    else if (record.action_type === 'SET_PANA') actionTypeClass = 'bg-violet-100 text-violet-800';
                    
                    // Status badge
                    const statusBadge = record.is_undone 
                        ? '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs font-semibold rounded">Undone</span>'
                        : '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded">Active</span>';
                    
                    // Delete button - only show if not already undone
                    const deleteButton = record.is_undone 
                        ? '<span class="text-gray-400 text-sm">-</span>'
                        : `<button onclick="deleteBulkAction(${record.id})" class="text-red-600 hover:text-red-800 hover:bg-red-50 p-2 rounded transition-colors" title="Delete bulk action">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                        </button>`;
                    
                    row.innerHTML = `
                        <td class="border border-gray-300 px-4 py-2 text-sm font-mono">${record.id}</td>
                        <td class="border border-gray-300 px-4 py-2">
                            <span class="px-2 py-1 ${actionTypeClass} text-xs font-semibold rounded">${record.action_type}</span>
                        </td>
                        <td class="border border-gray-300 px-4 py-2 text-sm font-semibold text-green-700">â‚¹${parseFloat(record.amount).toLocaleString('en-IN')}</td>
                        <td class="border border-gray-300 px-4 py-2 text-sm text-center font-semibold">${record.total_bets}</td>
                        <td class="border border-gray-300 px-4 py-2 text-sm text-center">${record.jodi_column || '-'}</td>
                        <td class="border border-gray-300 px-4 py-2 text-sm text-center">${record.jodi_type || '-'}</td>
                        <td class="border border-gray-300 px-4 py-2 text-sm font-mono">${record.created_at}</td>
                        <td class="border border-gray-300 px-4 py-2 text-center">${statusBadge}</td>
                        <td class="border border-gray-300 px-4 py-2 text-center">${deleteButton}</td>
                    `;
                    
                    historyTableBody.appendChild(row);
                });
            }

            function updateHistoryStats(history) {
                const totalRecords = history.length;
                const totalAmount = history.reduce((sum, record) => sum + parseFloat(record.amount) * record.total_bets, 0);
                const totalBets = history.reduce((sum, record) => sum + record.total_bets, 0);
                
                document.getElementById('totalRecords').textContent = totalRecords;
                document.getElementById('totalHistoryAmount').textContent = `â‚¹${totalAmount.toLocaleString('en-IN')}`;
                document.getElementById('totalHistoryBets').textContent = totalBets;
            }

            // Delete bulk action function
            window.deleteBulkAction = async function(bulkActionId) {
                if (!confirm('Are you sure you want to delete this bulk action? All associated bets will be permanently deleted.')) {
                    return;
                }

                try {
                    const response = await fetch(API.UNDO_BULK, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken()
                        },
                        body: JSON.stringify({ bulk_action_id: bulkActionId })
                    });

                    // Check if response is ok
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();

                    if (data.success) {
                        showToast('Deleted!', data.message, 'success');
                        
                        // Reload history table
                        await loadBulkActionHistory();
                        
                        // Reload bets and update totals
                        await loadBets();
                        await updateTotalAmount();
                        renderPage(1);
                        
                        // Update undo button visibility
                        await getLastBulkAction();
                    } else {
                        showToast('Error', data.message || 'Failed to delete bulk action', 'error');
                    }
                } catch (error) {
                    console.error('Error deleting bulk action:', error);
                    showToast('Error', error.message || 'Failed to delete bulk action', 'error');
                }
            };

            // Toggle History Modal
            document.getElementById('toggleHistoryBtn').addEventListener('click', function() {
                historyModal.classList.remove('hidden');
                loadBulkActionHistory();
            });

            document.getElementById('closeHistoryModal').addEventListener('click', function() {
                historyModal.classList.add('hidden');
            });

            document.getElementById('refreshHistoryBtn').addEventListener('click', function() {
                loadBulkActionHistory();
                showToast('Refreshed', 'History data updated', 'success');
            });

            // Close modal on outside click
            historyModal.addEventListener('click', function(e) {
                if (e.target === historyModal) {
                    historyModal.classList.add('hidden');
                }
            });

            // Initialize
            showLoader('Initializing...', 10);
            try {
                updateLoader(30, 'Loading bets...');
                await loadBets();
                updateLoader(70, 'Loading settings...');
                await getLastBulkAction();
                await updateTotalAmount();
                updateLoader(100, 'Ready!');
            } catch (err) {
                console.error('Initialization error:', err);
            } finally {
                setTimeout(() => hideLoader(), 500);
            }
        });
    </script>
</body>

</html>